<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #1a1a1a;
            --bg-panel: #2a2a2a;
            --bg-panel-hover: #333333;
            --text-primary: #e5e5e5;
            --text-secondary: #a0a0a0;
            --text-dark: #4a4a4a;
            --border-color: #3a3a3a;
            --gradient-primary: linear-gradient(135deg, #a855f7 0%, #3b82f6 100%);
            --gradient-button: linear-gradient(135deg, #9333ea 0%, #2563eb 100%);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            padding: 0;
            margin: 0;
        }


        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            padding: 40px 20px;
        }

        /* åŠŸèƒ½ä»‹ç»åŒºåŸŸ */
        .intro-section {
            background: var(--bg-panel);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
        }

        .intro-title {
            font-size: 2em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-align: center;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .intro-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-top: 32px;
        }

        .feature-item {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            padding: 20px;
            background: var(--bg-dark);
            border-radius: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .feature-item:hover {
            border-color: #a855f7;
            transform: translateY(-2px);
        }

        .feature-icon {
            font-size: 2em;
            line-height: 1;
        }

        .feature-content {
            flex: 1;
        }

        .feature-title {
            font-size: 1.1em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .feature-desc {
            font-size: 0.9em;
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* æ¨ªå¹…åŒºåŸŸ - çªå‡ºä¸»ä½“ */
        .hero-section {
            background: var(--bg-panel);
            border-radius: 16px;
            padding: 60px 40px;
            margin-bottom: 40px;
            text-align: center;
            border: 2px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 8px 32px rgba(168, 85, 247, 0.1);
        }

        .hero-title {
            font-size: 2.5em;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            letter-spacing: -0.02em;
        }

        /* æœç´¢æ  - çªå‡ºæ˜¾ç¤º */
        .search-container {
            max-width: 700px;
            margin: 40px auto 0;
            display: flex;
            gap: 8px;
            background: var(--bg-dark);
            border-radius: 12px;
            padding: 4px;
            border: 2px solid rgba(168, 85, 247, 0.5);
            box-shadow: 0 4px 16px rgba(168, 85, 247, 0.2);
        }

        .search-input {
            flex: 1;
            padding: 14px 20px;
            background: transparent;
            border: none;
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
        }

        .search-input::placeholder {
            color: var(--text-secondary);
        }

        .search-btn {
            padding: 14px 24px;
            background: var(--gradient-button);
            border: none;
            color: white;
            font-size: 14px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .search-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.4);
        }

        /* è¡¨å•å¡ç‰‡åŒºåŸŸ - çªå‡ºæ˜¾ç¤º */
        .form-section {
            background: var(--bg-panel);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            border: 2px solid rgba(168, 85, 247, 0.3);
            box-shadow: 0 8px 32px rgba(168, 85, 247, 0.1);
        }

        .form-section-title {
            font-size: 1.5em;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 32px;
            text-align: center;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .input-label {
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 600;
        }

        .input-field {
            padding: 14px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 16px;
            font-family: inherit;
            transition: all 0.2s ease;
            height: 48px;
            box-sizing: border-box;
        }

        .input-field:focus {
            outline: none;
            border-color: #a855f7;
            box-shadow: 0 0 0 3px rgba(168, 85, 247, 0.1);
        }

        .input-field::placeholder {
            color: var(--text-secondary);
        }

        /* æ»‘å—æ ·å¼ - ä¸è¾“å…¥æ¡†å¯¹é½ */
        .slider-wrapper {
            position: relative;
            padding: 0;
            margin-top: 0;
            min-height: 48px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .slider-value {
            text-align: center;
            font-size: 1.2em;
            font-weight: 700;
            color: #a855f7;
            margin-bottom: 12px;
            height: 24px;
            line-height: 24px;
            pointer-events: none;
            flex-shrink: 0;
            position: relative;
            z-index: 5;
            width: 100%;
        }

        .slider-track {
            width: 100%;
            height: 6px;
            background: var(--bg-dark);
            border-radius: 10px;
            position: absolute;
            top: 32px;
            left: 0;
            pointer-events: none;
            z-index: 1;
        }

        input[type="range"] {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            background: transparent;
            outline: none;
            -webkit-appearance: none;
            position: absolute;
            top: 25px;
            left: 0;
            z-index: 10;
            cursor: pointer;
            pointer-events: auto;
            margin: 0;
            padding: 0;
        }

        input[type="range"]::-webkit-slider-runnable-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: transparent;
            border-radius: 10px;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gradient-button);
            cursor: grab;
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.4);
            transition: all 0.2s ease;
            margin-top: -7px;
            position: relative;
            z-index: 15;
            border: none;
        }

        input[type="range"]::-webkit-slider-thumb:active {
            cursor: grabbing;
            transform: scale(1.2);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.6);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--gradient-button);
            cursor: grab;
            border: none;
            box-shadow: 0 2px 8px rgba(168, 85, 247, 0.4);
            transition: all 0.2s ease;
            z-index: 15;
        }

        input[type="range"]::-moz-range-thumb:active {
            cursor: grabbing;
            transform: scale(1.2);
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(168, 85, 247, 0.6);
        }

        input[type="range"]::-moz-range-track {
            width: 100%;
            height: 6px;
            cursor: pointer;
            background: transparent;
        }

        input[type="range"]:disabled::-webkit-slider-thumb {
            cursor: not-allowed;
            opacity: 0.5;
        }


        /* æäº¤æŒ‰é’® */
        .btn-submit {
            width: 100%;
            padding: 16px 32px;
            background: var(--gradient-button);
            border: none;
            color: white;
            font-size: 16px;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 14px rgba(168, 85, 247, 0.3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
        }

        .btn-submit:active {
            transform: translateY(0);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loader-container {
            display: none;
            text-align: center;
            margin: 40px 0;
        }

        .loader-container.active {
            display: block;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--bg-dark);
            border-top: 4px solid #a855f7;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-text {
            color: var(--text-primary);
            font-weight: 500;
            font-size: 16px;
        }

        /* é”™è¯¯æç¤º */
        .alert {
            display: none;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
            font-size: 14px;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }

        .alert.active {
            display: block;
        }

        /* ç»“æœå±•ç¤ºåŒºåŸŸ */
        .results-container {
            display: none;
            margin-top: 40px;
        }

        .results-container.active {
            display: block;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
        }

        .result-card {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .result-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
        }

        .result-card-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #a855f7;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .result-card-content {
            color: var(--text-secondary);
            line-height: 1.8;
            white-space: pre-wrap;
            word-wrap: break-word;
            font-size: 14px;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .intro-section {
                padding: 24px;
            }

            .intro-title {
                font-size: 1.5em;
            }

            .intro-features {
                grid-template-columns: 1fr;
            }

            .hero-title {
                font-size: 1.8em;
            }

            .hero-section {
                padding: 40px 20px;
            }

            .form-section {
                padding: 24px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .results-grid {
                grid-template-columns: 1fr;
            }
        }

        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .form-section,
        .result-card {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- åŠŸèƒ½ä»‹ç»åŒºåŸŸ -->
        <div class="intro-section">
            <h1 class="intro-title">è§†é¢‘è„šæœ¬ç”Ÿæˆå™¨</h1>
            <p style="text-align: center; color: var(--text-secondary); font-size: 1.1em; margin-bottom: 16px;">
                åŸºäºAIæŠ€æœ¯ï¼Œå¿«é€Ÿç”Ÿæˆä¸“ä¸šè§†é¢‘è„šæœ¬
            </p>
            <div class="intro-features">
                <div class="feature-item">
                    <div class="feature-icon">ğŸ¯</div>
                    <div class="feature-content">
                        <div class="feature-title">æ™ºèƒ½ä¸»é¢˜åˆ†æ</div>
                        <div class="feature-desc">è¾“å…¥ä»»æ„è§†é¢‘ä¸»é¢˜ï¼ŒAIè‡ªåŠ¨åˆ†æå¹¶ç†è§£å†…å®¹éœ€æ±‚</div>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“</div>
                    <div class="feature-content">
                        <div class="feature-title">è‡ªåŠ¨ç”Ÿæˆè„šæœ¬</div>
                        <div class="feature-desc">æ ¹æ®ä¸»é¢˜å’Œæ—¶é•¿ï¼Œè‡ªåŠ¨ç”Ÿæˆå®Œæ•´çš„è§†é¢‘æ ‡é¢˜å’Œè„šæœ¬å†…å®¹</div>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">ğŸ“š</div>
                    <div class="feature-content">
                        <div class="feature-title">ç»´åŸºç™¾ç§‘å‚è€ƒ</div>
                        <div class="feature-desc">è‡ªåŠ¨æœç´¢ç»´åŸºç™¾ç§‘ï¼Œæä¾›å‡†ç¡®çš„ä¿¡æ¯å‚è€ƒå’Œæ•°æ®æ”¯æŒ</div>
                    </div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon">âœ¨</div>
                    <div class="feature-content">
                        <div class="feature-title">å¯è°ƒåˆ›é€ åŠ›</div>
                        <div class="feature-desc">çµæ´»è°ƒèŠ‚åˆ›é€ åŠ›å‚æ•°ï¼Œæ§åˆ¶è„šæœ¬çš„åˆ›æ–°ç¨‹åº¦å’Œé£æ ¼</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨ªå¹…åŒºåŸŸ - ä¸»é¢˜è¾“å…¥ -->
        <div class="hero-section">
            <h2 class="hero-title">å¼€å§‹åˆ›ä½œ</h2>
            <div class="search-container">
                <input 
                    type="text" 
                    class="search-input" 
                    id="subject" 
                    placeholder="è¯·è¾“å…¥è§†é¢‘ä¸»é¢˜ï¼Œä¾‹å¦‚ï¼šäººå·¥æ™ºèƒ½ã€ç§‘æŠ€è¶‹åŠ¿ã€å†å²æ–‡åŒ–ç­‰"
                >
                <button class="search-btn" id="searchBtn">ğŸš€ ç”Ÿæˆ</button>
            </div>
        </div>

        <!-- è¡¨å•åŒºåŸŸ -->
        <div class="form-section">
            <h3 class="form-section-title">å‚æ•°è®¾ç½®</h3>
            <form id="scriptForm">
                <div class="form-grid">
                    <div class="input-group">
                        <label class="input-label" for="apiKey">APIå¯†é’¥</label>
                        <input 
                            type="password" 
                            id="apiKey" 
                            name="apiKey" 
                            class="input-field" 
                            placeholder="è¯·è¾“å…¥æ‚¨çš„ARK APIå¯†é’¥ï¼ˆå¯é€‰ï¼‰"
                        >
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="videoLength">è§†é¢‘æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                        <input 
                            type="number" 
                            id="videoLength" 
                            name="videoLength" 
                            class="input-field" 
                            min="1" 
                            max="60" 
                            value="1" 
                            required
                        >
                    </div>

                    <div class="input-group">
                        <label class="input-label" for="creativity">
                            åˆ›é€ åŠ›å‚æ•° 
                            <span style="font-size: 0.85em; font-weight: 400; color: var(--text-secondary); margin-left: 8px;">
                                (0-1ä¹‹é—´ï¼Œå€¼è¶Šå¤§è¶Šæœ‰åˆ›æ„)
                            </span>
                        </label>
                        <div class="slider-wrapper">
                            <div class="slider-value" id="creativityValue">0.7</div>
                            <div class="slider-track"></div>
                            <input 
                                type="range" 
                                id="creativity" 
                                name="creativity" 
                                min="0" 
                                max="1" 
                                step="0.1" 
                                value="0.7"
                            >
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn-submit" id="submitBtn">
                    å¼€å§‹ç”Ÿæˆè„šæœ¬
                </button>
            </form>

            <!-- åŠ è½½åŠ¨ç”» -->
            <div class="loader-container" id="loader">
                <div class="spinner"></div>
                <p class="loader-text">æ­£åœ¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...</p>
            </div>

            <!-- é”™è¯¯æç¤º -->
            <div class="alert" id="error"></div>
        </div>

        <!-- ç»“æœå±•ç¤º -->
        <div class="results-container" id="results">
            <div class="results-grid">
                <div class="result-card">
                    <div class="result-card-title">âœ¨ è§†é¢‘æ ‡é¢˜</div>
                    <div class="result-card-content" id="titleContent"></div>
                </div>

                <div class="result-card">
                    <div class="result-card-title">ğŸ“ è§†é¢‘è„šæœ¬</div>
                    <div class="result-card-content" id="scriptContent"></div>
                </div>

                <div class="result-card">
                    <div class="result-card-title">ğŸ“š ç»´åŸºç™¾ç§‘å‚è€ƒä¿¡æ¯</div>
                    <div class="result-card-content" id="wikiContent"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœåŠ¡å™¨è¿æ¥
        window.addEventListener('DOMContentLoaded', async function() {
            const currentUrl = window.location.href;
            console.log('ğŸ“ å½“å‰é¡µé¢ URL:', currentUrl);
            
            // æ£€æŸ¥æ˜¯å¦ç›´æ¥æ‰“å¼€ HTML æ–‡ä»¶
            if (currentUrl.startsWith('file://')) {
                const errorDiv = document.getElementById('error');
                errorDiv.textContent = 'âŒ é”™è¯¯ï¼šæ£€æµ‹åˆ°ç›´æ¥æ‰“å¼€äº† HTML æ–‡ä»¶ï¼\n\nâš ï¸ å¿…é¡»é€šè¿‡ Flask æœåŠ¡å™¨è®¿é—®é¡µé¢ï¼\n\næ­£ç¡®æ­¥éª¤ï¼š\n1. æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•\n2. è¿è¡Œ: python app.py\n3. å¤åˆ¶ç»ˆç«¯æ˜¾ç¤ºçš„åœ°å€ï¼ˆå¦‚ http://localhost:5001ï¼‰\n4. åœ¨æµè§ˆå™¨ä¸­è®¿é—®è¯¥åœ°å€\n\nå½“å‰é”™è¯¯ï¼šä½ ç›´æ¥æ‰“å¼€äº†æ–‡ä»¶ï¼Œè€Œä¸æ˜¯é€šè¿‡æœåŠ¡å™¨è®¿é—®';
                errorDiv.classList.add('active');
                document.getElementById('submitBtn').disabled = true;
                return;
            }
            
            try {
                console.log('ğŸ” æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨è¿æ¥...');
                const response = await fetch('/api/health', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status);
                
                if (!response.ok) {
                    throw new Error(`æœåŠ¡å™¨å“åº”å¼‚å¸¸: HTTP ${response.status}`);
                }
                
                // å®‰å…¨åœ°è§£æJSON
                const contentType = response.headers.get('content-type');
                let data;
                if (contentType && contentType.includes('application/json')) {
                    const text = await response.text();
                    if (!text || text.trim() === '') {
                        throw new Error('æœåŠ¡å™¨è¿”å›äº†ç©ºå“åº”');
                    }
                    try {
                        data = JSON.parse(text);
                    } catch (parseError) {
                        console.error('JSONè§£æé”™è¯¯:', parseError);
                        throw new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼é”™è¯¯');
                    }
                } else {
                    const text = await response.text();
                    throw new Error(`æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”: ${text.substring(0, 100)}`);
                }
                
                console.log('âœ… æœåŠ¡å™¨è¿æ¥æ­£å¸¸:', data);
                
                // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯
                document.getElementById('error').classList.remove('active');
            } catch (err) {
                console.error('âŒ è¿æ¥å¤±è´¥:', err);
                const errorDiv = document.getElementById('error');
                let errorMsg = 'âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼\n\n';
                
                if (err.message.includes('Failed to fetch') || err.name === 'TypeError') {
                    errorMsg += 'å¯èƒ½çš„åŸå› ï¼š\n';
                    errorMsg += '1. Flask æœåŠ¡å™¨æœªè¿è¡Œ\n';
                    errorMsg += '   â†’ è¯·åœ¨ç»ˆç«¯è¿è¡Œ: python app.py\n\n';
                    errorMsg += '2. è®¿é—®åœ°å€ä¸æ­£ç¡®\n';
                    errorMsg += '   â†’ è¯·ä½¿ç”¨ç»ˆç«¯æ˜¾ç¤ºçš„åœ°å€ï¼ˆå¦‚ http://localhost:5001ï¼‰\n\n';
                    errorMsg += '3. æœåŠ¡å™¨å¯åŠ¨å¤±è´¥\n';
                    errorMsg += '   â†’ æ£€æŸ¥ç»ˆç«¯æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯\n\n';
                    errorMsg += 'å½“å‰ URL: ' + currentUrl + '\n';
                    errorMsg += 'é”™è¯¯è¯¦æƒ…: ' + err.message;
                } else {
                    errorMsg += 'é”™è¯¯: ' + err.message;
                }
                
                errorDiv.textContent = errorMsg;
                errorDiv.classList.add('active');
                document.getElementById('submitBtn').disabled = true;
            }
        });

        // æœç´¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.getElementById('searchBtn').addEventListener('click', function() {
            document.getElementById('scriptForm').dispatchEvent(new Event('submit'));
        });

        // æ»‘å—å€¼æ˜¾ç¤º
        const creativitySlider = document.getElementById('creativity');
        const creativityValue = document.getElementById('creativityValue');
        
        if (creativitySlider && creativityValue) {
            // åˆå§‹åŒ–æ˜¾ç¤º
            creativityValue.textContent = creativitySlider.value;
            
            // ç›‘å¬è¾“å…¥äº‹ä»¶
            creativitySlider.addEventListener('input', function() {
                creativityValue.textContent = this.value;
            });
            
            // ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶ï¼ˆç¡®ä¿å®æ—¶æ›´æ–°ï¼‰
            creativitySlider.addEventListener('mousemove', function() {
                if (this === document.activeElement) {
                    creativityValue.textContent = this.value;
                }
            });
        }

        // è¡¨å•æäº¤
        const form = document.getElementById('scriptForm');
        const submitBtn = document.getElementById('submitBtn');
        const loader = document.getElementById('loader');
        const results = document.getElementById('results');
        const error = document.getElementById('error');

        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // é‡ç½®çŠ¶æ€
            results.classList.remove('active');
            error.classList.remove('active');
            loader.classList.add('active');
            submitBtn.disabled = true;

            const subject = document.getElementById('subject').value.trim();
            if (!subject) {
                error.textContent = 'è¯·è¾“å…¥è§†é¢‘ä¸»é¢˜';
                error.classList.add('active');
                loader.classList.remove('active');
                submitBtn.disabled = false;
                return;
            }

            const formData = {
                subject: subject,
                api_key: document.getElementById('apiKey').value.trim(),
                video_length: parseFloat(document.getElementById('videoLength').value),
                creativity: parseFloat(document.getElementById('creativity').value)
            };

            try {
                const response = await fetch('/api/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                // å…ˆè¯»å–å“åº”æ–‡æœ¬ï¼ˆåªèƒ½è¯»å–ä¸€æ¬¡ï¼‰
                const responseText = await response.text();
                const contentType = response.headers.get('content-type') || '';
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!response.ok) {
                    // å°è¯•è§£æé”™è¯¯å“åº”
                    let errorData;
                    if (contentType.includes('application/json')) {
                        try {
                            errorData = JSON.parse(responseText);
                        } catch (e) {
                            console.error('è§£æé”™è¯¯å“åº”å¤±è´¥:', e);
                            errorData = { error: `æœåŠ¡å™¨é”™è¯¯: HTTP ${response.status}` };
                        }
                    } else {
                        errorData = { error: responseText || `æœåŠ¡å™¨é”™è¯¯: HTTP ${response.status}` };
                    }
                    throw new Error(errorData.error || 'ç”Ÿæˆå¤±è´¥');
                }

                // è§£æJSONå“åº”
                let data;
                if (!responseText || responseText.trim() === '') {
                    throw new Error('æœåŠ¡å™¨è¿”å›äº†ç©ºå“åº”');
                }
                
                if (contentType.includes('application/json')) {
                    try {
                        data = JSON.parse(responseText);
                    } catch (parseError) {
                        console.error('JSONè§£æé”™è¯¯:', parseError);
                        console.error('å“åº”å†…å®¹:', responseText.substring(0, 200));
                        throw new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼é”™è¯¯ï¼Œæ— æ³•è§£æJSONã€‚è¯·æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—ã€‚');
                    }
                } else {
                    console.error('éJSONå“åº”ï¼ŒContent-Type:', contentType);
                    console.error('å“åº”å†…å®¹:', responseText.substring(0, 200));
                    throw new Error(`æœåŠ¡å™¨è¿”å›äº†éJSONå“åº”ã€‚Content-Type: ${contentType}`);
                }

                // éªŒè¯æ•°æ®
                if (!data || typeof data !== 'object') {
                    throw new Error('æœåŠ¡å™¨è¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®');
                }

                // æ˜¾ç¤ºç»“æœ
                document.getElementById('titleContent').textContent = data.title || 'æš‚æ— æ ‡é¢˜';
                document.getElementById('scriptContent').textContent = data.script || 'æš‚æ— è„šæœ¬';
                document.getElementById('wikiContent').textContent = data.search_result || 'æš‚æ— å‚è€ƒä¿¡æ¯';
                
                results.classList.add('active');
                
                // æ»šåŠ¨åˆ°ç»“æœåŒºåŸŸ
                results.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
            } catch (err) {
                let errorMessage = 'é”™è¯¯: ' + err.message;
                
                // å¦‚æœæ˜¯JSONè§£æé”™è¯¯
                if (err.message.includes('Expecting value') || err.message.includes('JSON')) {
                    errorMessage = 'âŒ æœåŠ¡å™¨å“åº”æ ¼å¼é”™è¯¯ï¼\n\nå¯èƒ½çš„åŸå› ï¼š\n1. æœåŠ¡å™¨è¿”å›äº†éJSONæ•°æ®\n2. æœåŠ¡å™¨å†…éƒ¨é”™è¯¯\n3. APIå¯†é’¥æœªè®¾ç½®æˆ–é”™è¯¯\n\nå»ºè®®ï¼š\n- æ£€æŸ¥ç»ˆç«¯ä¸­çš„æœåŠ¡å™¨æ—¥å¿—\n- ç¡®è®¤ARK_API_KEYç¯å¢ƒå˜é‡å·²æ­£ç¡®è®¾ç½®\n- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰è·å–è¯¦ç»†ä¿¡æ¯';
                }
                // å¦‚æœæ˜¯ç½‘ç»œé”™è¯¯
                else if (err.message.includes('Failed to fetch') || err.message.includes('NetworkError')) {
                    errorMessage = 'âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼\n\nå¯èƒ½çš„åŸå› ï¼š\n1. Flask æœåŠ¡å™¨æœªè¿è¡Œ - è¯·åœ¨ç»ˆç«¯è¿è¡Œ: python app.py\n2. è®¿é—®åœ°å€ä¸æ­£ç¡® - è¯·ä½¿ç”¨ Flask æœåŠ¡å™¨æ˜¾ç¤ºçš„åœ°å€\n3. ç½‘ç»œè¿æ¥é—®é¢˜\n\nå½“å‰é”™è¯¯: ' + err.message;
                }
                // å¦‚æœæ˜¯å…¶ä»–é”™è¯¯
                else {
                    errorMessage = 'âŒ ' + err.message;
                }
                
                error.textContent = errorMessage;
                error.classList.add('active');
                console.error('è¯¦ç»†é”™è¯¯ä¿¡æ¯:', err);
            } finally {
                loader.classList.remove('active');
                submitBtn.disabled = false;
            }
        });
    </script>
</body>
</html>