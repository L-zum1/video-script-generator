# 🚀 视频脚本生成器 - 部署指南

本指南将帮助您将这个Flask应用部署到云平台，让其他人可以通过网页访问。

## 📋 部署前准备

### 1. 确保代码已准备好

确保以下文件存在：
- `app.py` - Flask应用主文件
- `main.html` - 前端页面
- `untils.py` - 核心逻辑
- `requirements.txt` - Python依赖
- `Procfile` - 进程配置文件（已创建）

### 2. 准备API密钥

您需要有一个 `ARK_API_KEY`，部署时需要在云平台的环境变量中配置。

---

## 🌐 部署方案

我们推荐以下几种部署方案，您可以选择最适合的：

### 方案1：Render（推荐，免费）

**优点：** 
- 提供免费层（有限制但足够使用）
- 部署简单，自动从GitHub部署
- 支持自定义域名

**部署步骤：**

1. **注册账号**
   - 访问 [render.com](https://render.com)
   - 使用GitHub账号登录

2. **连接GitHub仓库**
   - 将代码推送到GitHub仓库
   - 在Render控制台点击 "New +" → "Web Service"
   - 连接您的GitHub仓库

3. **配置服务**
   - **Name**: `video-script-generator`（或您喜欢的名称）
   - **Region**: 选择离您最近的区域
   - **Branch**: `main` 或 `master`
   - **Root Directory**: 留空（如果代码在根目录）
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `gunicorn app:app`

4. **设置环境变量**
   - 在 "Environment" 部分添加：
     - Key: `ARK_API_KEY`
     - Value: 您的API密钥

5. **部署**
   - 点击 "Create Web Service"
   - 等待部署完成（通常需要3-5分钟）
   - 部署成功后，您会得到一个URL，例如：`https://video-script-generator.onrender.com`

---

### 方案2：Railway

**优点：**
- 提供免费额度（$5/月）
- 部署简单
- 自动HTTPS

**部署步骤：**

1. **注册账号**
   - 访问 [railway.app](https://railway.app)
   - 使用GitHub账号登录

2. **创建新项目**
   - 点击 "New Project"
   - 选择 "Deploy from GitHub repo"
   - 选择您的仓库

3. **配置环境变量**
   - 在项目设置中添加环境变量：
     - `ARK_API_KEY` = 您的API密钥
   - Railway会自动检测到Python项目

4. **部署**
   - Railway会自动开始部署
   - 部署完成后，点击 "Settings" → "Generate Domain" 获取访问URL

---

### 方案3：Fly.io

**优点：**
- 提供免费层
- 全球分布式部署
- 命令行工具强大

**部署步骤：**

1. **安装Fly CLI**
   ```bash
   curl -L https://fly.io/install.sh | sh
   ```

2. **登录**
   ```bash
   fly auth login
   ```

3. **创建应用**
   ```bash
   fly launch
   ```
   - 输入应用名称
   - 选择区域
   - 选择不部署PostgreSQL（如果询问）

4. **设置环境变量**
   ```bash
   fly secrets set ARK_API_KEY=your-api-key-here
   ```

5. **部署**
   ```bash
   fly deploy
   ```

---

### 方案4：PythonAnywhere

**优点：**
- 专门为Python设计
- 免费账户可用（有限制）
- 支持Flask

**部署步骤：**

1. **注册账号**
   - 访问 [pythonanywhere.com](https://www.pythonanywhere.com)
   - 注册免费账号

2. **上传代码**
   - 在 "Files" 标签页上传所有项目文件
   - 或使用Git克隆仓库

3. **配置Web应用**
   - 在 "Web" 标签页点击 "Add a new web app"
   - 选择 Flask 和 Python 版本
   - 设置源代码目录

4. **安装依赖**
   - 在 "Tasks" 标签页或 Bash Console 运行：
   ```bash
   pip3.10 install --user -r requirements.txt
   ```

5. **配置环境变量**
   - 在 Web 应用的配置文件中添加：
   ```python
   import os
   os.environ['ARK_API_KEY'] = 'your-api-key-here'
   ```

6. **设置WSGI文件**
   - 在 Web 标签页的 WSGI configuration file 中：
   ```python
   import sys
   path = '/home/yourusername/path/to/your/app'
   if path not in sys.path:
       sys.path.append(path)
   
   from app import app as application
   ```

7. **重载应用**
   - 点击 "Reload" 按钮

---

## 🔧 本地测试生产环境

在部署之前，您可以本地测试生产环境配置：

1. **安装gunicorn**
   ```bash
   pip install gunicorn
   ```

2. **设置环境变量**
   ```bash
   export ARK_API_KEY='your-api-key-here'
   export PORT=5000
   ```

3. **启动服务**
   ```bash
   gunicorn app:app --bind 0.0.0.0:5000 --workers 2
   ```

4. **访问**
   - 浏览器访问 `http://localhost:5000`

---

## 📝 部署后检查清单

- [ ] 应用可以正常访问
- [ ] 首页正常显示
- [ ] API健康检查正常（访问 `/api/health`）
- [ ] 可以提交表单并生成脚本
- [ ] 环境变量已正确设置（`ARK_API_KEY`）
- [ ] HTTPS正常工作（大部分平台自动提供）

---

## 🐛 常见问题

### 问题1：部署失败

**可能原因：**
- 依赖安装失败
- 代码有语法错误
- 端口配置不正确

**解决方法：**
- 查看部署日志
- 确保 `requirements.txt` 包含所有依赖
- 检查 `Procfile` 配置是否正确

### 问题2：应用启动但无法访问

**可能原因：**
- 环境变量未设置
- API密钥错误
- 端口绑定问题

**解决方法：**
- 检查环境变量配置
- 查看应用日志
- 确保 `ARK_API_KEY` 已正确设置

### 问题3：请求超时

**可能原因：**
- AI API响应慢
- 超时设置太短

**解决方法：**
- 增加gunicorn的timeout设置
- 在 `gunicorn_config.py` 中调整 `timeout` 值

---

## 🔐 安全建议

1. **不要将API密钥提交到Git仓库**
   - 使用 `.gitignore` 忽略 `.env` 文件
   - 只通过平台的环境变量设置密钥

2. **使用HTTPS**
   - 大部分平台自动提供HTTPS
   - 确保启用HTTPS重定向

3. **设置访问限制**（可选）
   - 如果不想公开访问，可以添加简单的认证

---

## 📞 需要帮助？

如果遇到问题：
1. 查看平台官方文档
2. 检查应用日志
3. 确认所有环境变量已正确设置

祝部署顺利！🎉

